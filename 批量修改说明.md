# 表格状态显示和操作统一修改方案

## 需要修改的文件列表

1. `src/views/agent/AllyList.vue`
2. `src/views/agent/AllyList10.vue`
3. `src/views/agent/ListV2.vue`
4. `src/views/product/ProductList.vue`
5. `src/views/product/DepositPolicy.vue`
6. `src/views/product/PlatformManage.vue`
7. `src/views/product/ProductRisePrice.vue`
8. `src/views/product/SettleRisePrice.vue`
9. `src/views/product/TrafficPolicy.vue`

## 修改步骤

### 1. 添加批量操作按钮

在工具栏添加批量启用/禁用按钮：

```vue
<div class="toolbar">
  <el-button type="primary" @click="handleAdd">新增</el-button>
  <el-button
    type="success"
    :disabled="selectedIds.length === 0"
    @click="handleBatchEnable"
  >
    批量启用
  </el-button>
  <el-button
    type="warning"
    :disabled="selectedIds.length === 0"
    @click="handleBatchDisable"
  >
    批量禁用
  </el-button>
  <el-button
    type="danger"
    :disabled="selectedIds.length === 0"
    @click="handleBatchDelete"
  >
    批量删除
  </el-button>
</div>
```

### 2. 添加多选列

在表格中添加 selection 列：

```vue
<el-table v-loading="loading" :data="tableData" @selection-change="handleSelectionChange">
  <el-table-column type="selection" width="55" align="center" />
  <!-- 其他列 -->
</el-table>
```

### 3. 修改状态列显示

将 el-switch 改为 el-tag：

**修改前：**

```vue
<el-table-column label="状态" width="100" align="center">
  <template #default="{ row }">
    <el-switch
      v-model="row.status"
      :active-value="1"
      :inactive-value="0"
      @change="handleStatusChange(row)"
    />
  </template>
</el-table-column>
```

**修改后：**

```vue
<el-table-column label="状态" min-width="100" align="center">
  <template #default="{ row }">
    <el-tag :type="row.status === 1 ? 'success' : 'danger'">
      {{ row.status === 1 ? '启用' : '禁用' }}
    </el-tag>
  </template>
</el-table-column>
```

### 4. 在操作列添加启用/禁用按钮

**修改前：**

```vue
<el-table-column label="操作" width="150" align="center">
  <template #default="{ row }">
    <div class="table-actions">
      <el-link type="primary" :underline="true" @click="handleEdit(row)">编辑</el-link>
      <el-link type="danger" :underline="true" @click="handleDelete(row)">删除</el-link>
    </div>
  </template>
</el-table-column>
```

**修改后：**

```vue
<el-table-column label="操作" min-width="250" align="center" fixed="right">
  <template #default="{ row }">
    <div class="table-actions">
      <el-link type="primary" :underline="true" @click="handleEdit(row)">编辑</el-link>
      <el-link
        :type="row.status === 1 ? 'warning' : 'success'"
        :underline="true"
        @click="handleToggleStatus(row)"
      >
        {{ row.status === 1 ? '禁用' : '启用' }}
      </el-link>
      <el-link type="danger" :underline="true" @click="handleDelete(row)">删除</el-link>
    </div>
  </template>
</el-table-column>
```

### 5. 添加选中状态管理

```typescript
// 选中的数据
const selectedIds = ref<number[]>([])

// 表格选择变化
const handleSelectionChange = (selection: any[]) => {
  selectedIds.value = selection.map((item) => item.id)
}
```

### 6. 添加启用/禁用处理函数

```typescript
// 切换启用/禁用状态
const handleToggleStatus = async (row: any) => {
  const isEnabled = row.status === 1
  const action = isEnabled ? '禁用' : '启用'

  try {
    await ElMessageBox.confirm(`确定要${action}吗？`, '提示', {
      confirmButtonText: '确定',
      cancelButtonText: '取消',
      type: 'warning'
    })

    // 调用对应的启用/禁用接口
    const res = isEnabled ? await setDisableApi(row.id) : await setEnableApi(row.id)

    if (res.code === 1) {
      ElMessage.success(res.msg || `${action}成功`)
      getList()
    } else {
      ElMessage.error(res.msg || `${action}失败`)
    }
  } catch (error) {
    if (error !== 'cancel') {
      console.error(`${action}失败:`, error)
      ElMessage.error(`${action}失败，请稍后重试`)
    }
  }
}

// 批量启用
const handleBatchEnable = async () => {
  try {
    await ElMessageBox.confirm(`确定要启用选中的 ${selectedIds.value.length} 项吗？`, '提示', {
      confirmButtonText: '确定',
      cancelButtonText: '取消',
      type: 'warning'
    })

    const res = await setEnableApi(selectedIds.value.join(','))

    if (res.code === 1) {
      ElMessage.success(res.msg || '批量启用成功')
      selectedIds.value = []
      getList()
    } else {
      ElMessage.error(res.msg || '批量启用失败')
    }
  } catch (error) {
    if (error !== 'cancel') {
      console.error('批量启用失败:', error)
      ElMessage.error('批量启用失败，请稍后重试')
    }
  }
}

// 批量禁用
const handleBatchDisable = async () => {
  try {
    await ElMessageBox.confirm(`确定要禁用选中的 ${selectedIds.value.length} 项吗？`, '提示', {
      confirmButtonText: '确定',
      cancelButtonText: '取消',
      type: 'warning'
    })

    const res = await setDisableApi(selectedIds.value.join(','))

    if (res.code === 1) {
      ElMessage.success(res.msg || '批量禁用成功')
      selectedIds.value = []
      getList()
    } else {
      ElMessage.error(res.msg || '批量禁用失败')
    }
  } catch (error) {
    if (error !== 'cancel') {
      console.error('批量禁用失败:', error)
      ElMessage.error('批量禁用失败，请稍后重试')
    }
  }
}
```

### 7. 删除旧的 switch 处理函数

删除类似这样的函数：

```typescript
const handleStatusChange = async (row: any) => {
  // 删除这个函数
}
```

## 注意事项

1. **接口地址**：每个页面的启用/禁用接口地址不同，需要根据实际情况调整
2. **参数名称**：确认接口参数是 `ids` 还是其他名称
3. **成功判断**：确认接口成功返回的 code 值（通常是 1）
4. **数据类型**：确保 TypeScript 类型定义正确

## 已完成的页面

- ✅ `src/views/system/PermissionManage.vue` - 权限管理
- ✅ `src/views/system/EmployeeManage.vue` - 员工设置

## 待修改的页面

需要按照上述方案逐个修改其他页面。
